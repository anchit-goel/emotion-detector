<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotion Detector - AI Text Analysis</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <header class="header">
            <h1>üé≠ Emotion Detector</h1>
        </header>

        <div class="main-grid">
            <div class="main-content">
                <div class="card input-section">
                    <label class="form-label" for="textInput">Enter your text</label>
                    <textarea id="textInput" class="textarea"
                        placeholder="Type something to analyze... For example: 'I'm so excited about this amazing opportunity!'"></textarea>
                    <div class="button-group">
                        <button id="analyzeBtn" class="btn btn-primary">Analyze Emotion</button>
                        <button id="clearBtn" class="btn btn-secondary">Clear</button>
                    </div>
                </div>
                <div class="card results-section" id="resultsSection">
                    <div class="primary-emotion" id="primaryEmotion">
                        <div class="emotion-emoji" id="primaryEmoji">üòä</div>
                        <div class="emotion-name" id="primaryName">Happy</div>
                        <div class="emotion-confidence" id="primaryConfidence">95% Confidence</div>
                    </div>
                    <h3 class="section-title">All Emotions</h3>
                    <div class="emotion-bars" id="emotionBars">
                        <!-- Emotion bars will be generated here -->
                    </div>
                </div>
                <div class="card examples-section">
                    <h3 class="section-title">Try These Examples</h3>
                    <div class="examples-grid" id="examplesGrid">
                        <!-- Examples will be generated here -->
                    </div>
                </div>
            </div>

            <!-- History Section (shared) -->
            <div class="card history-section">
                <h3 class="section-title">Recent Analysis</h3>
                <ul class="history-list" id="historyList">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <div class="empty-state-text">No analysis yet. Start by entering some text!</div>
                    </div>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // ---- EMOTION DATA ----
        // ---- EMOTION DATA ----
        // Keywords for distinguishing negative emotions (since AFINN is just positive/negative)
        // Client-side logic removed. Analysis is now handled by Python backend.

        const EMOTIONS = {
            happy: { emoji: 'üòä', name: 'Happy', color: 'var(--emotion-happy)' },
            sad: { emoji: 'üò¢', name: 'Sad', color: 'var(--emotion-sad)' },
            angry: { emoji: 'üò†', name: 'Angry', color: 'var(--emotion-angry)' },
            fearful: { emoji: 'üò®', name: 'Fearful', color: 'var(--emotion-fearful)' },
            neutral: { emoji: 'üòê', name: 'Neutral', color: 'var(--emotion-neutral)' }
        };

        const EXAMPLES = [
            { text: "I am absolutely furious about this situation!", expected: "Angry" },
            { text: "I'm so excited to see you!", expected: "Happy" },
            { text: "I feel so lonely and sad today.", expected: "Sad" },
            { text: "The movie was okay, nothing special.", expected: "Neutral" }
        ];

        let analysisHistory = [];
        function displayResults(result) {
            const resultsSection = document.getElementById('resultsSection');
            const primaryEmoji = document.getElementById('primaryEmoji');
            const primaryName = document.getElementById('primaryName');
            const primaryConfidence = document.getElementById('primaryConfidence');
            const emotionBars = document.getElementById('emotionBars');
            resultsSection.classList.add('visible');
            const emotion = EMOTIONS[result.primary] || EMOTIONS['neutral'];
            primaryEmoji.textContent = emotion.emoji;
            primaryName.textContent = emotion.name;
            primaryConfidence.textContent = `${result.confidence}% Confidence`;
            primaryName.style.color = emotion.color;
            // Bars (for text mode, only 5 emotions)
            emotionBars.innerHTML = '';
            ['happy', 'sad', 'angry', 'fearful', 'neutral'].forEach(key => {
                const emotionInfo = EMOTIONS[key];
                const score = result.scores[key] || 0;
                const barDiv = document.createElement('div');
                barDiv.className = 'emotion-bar';
                barDiv.innerHTML = `
                    <div class="emotion-bar-header">
                        <div class="emotion-bar-label">
                            <span class="emotion-bar-emoji">${emotionInfo.emoji}</span>
                            <span>${emotionInfo.name}</span>
                        </div>
                        <span class="emotion-bar-value">${score}%</span>
                    </div>
                    <div class="emotion-bar-track">
                        <div class="emotion-bar-fill" style="width: ${score}%; background-color: ${emotionInfo.color};"></div>
                    </div>
                `;
                emotionBars.appendChild(barDiv);
            });
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        function addToHistory(result) {
            analysisHistory.unshift(result);
            if (analysisHistory.length > 15) analysisHistory.pop();
            updateHistoryDisplay();
        }
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            if (analysisHistory.length === 0) {
                historyList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üìù</div>
                    <div class="empty-state-text">No analysis yet. Start by entering some text or use the camera!</div>
                </div>`;
                return;
            }
            historyList.innerHTML = '';
            analysisHistory.forEach(result => {
                const emotion = EMOTIONS[result.primary] || EMOTIONS['neutral'];
                const li = document.createElement('li');
                li.className = 'history-item';
                const textOrSource = result.text ? result.text : (result.mode === 'camera' ? '[Camera]' : 'Input');
                li.innerHTML = `
                    <div class="history-emotion">
                        <span class="history-emoji">${emotion.emoji}</span>
                        <span class="history-emotion-name" style="color: ${emotion.color};">${emotion.name}</span>
                        <span class="history-confidence">(${result.confidence}%)</span>
                    </div>
                    <div class="history-text" title="${textOrSource}">${textOrSource}</div>
                `;
                historyList.appendChild(li);
            });
        }
        function generateExamples() {
            const examplesGrid = document.getElementById('examplesGrid');
            examplesGrid.innerHTML = '';
            EXAMPLES.forEach(example => {
                const btn = document.createElement('button');
                btn.className = 'example-btn';
                btn.innerHTML = `<div class="example-text">"${example.text}"</div><div class="example-label">Expected: ${example.expected}</div>`;
                btn.addEventListener('click', () => {
                    document.getElementById('textInput').value = example.text;
                    analyzeText();
                });
                examplesGrid.appendChild(btn);
            });
        }
        async function analyzeText() {
            const textInput = document.getElementById('textInput');
            const text = textInput.value.trim();
            if (!text) { alert('Please enter some text to analyze.'); return; }

            const btn = document.getElementById('analyzeBtn');
            const originalText = btn.textContent;
            btn.textContent = 'Analyzing...';
            btn.disabled = true;

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });
                const result = await response.json();
                if (result) {
                    displayResults(result);
                    addToHistory(result);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to analyze text. Ensure the server is running.');
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }
        function clearInput() {
            document.getElementById('textInput').value = '';
            document.getElementById('resultsSection').classList.remove('visible');
        }
        document.getElementById('analyzeBtn').addEventListener('click', analyzeText);
        document.getElementById('clearBtn').addEventListener('click', clearInput);
        document.getElementById('textInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && e.ctrlKey) analyzeText();
        });
        generateExamples();

    </script>
</body>

</html>